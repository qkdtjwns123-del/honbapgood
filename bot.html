<!-- === filename: bot.html (í…ŒìŠ¤íŠ¸ë´‡ ì „ìš©) === -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í˜¼ë°¥ëŸ¬ Â· í…ŒìŠ¤íŠ¸ ë´‡</title>
    <link rel="stylesheet" href="style.css" />
    <script type="module" src="./firebase.js?v=26"></script>
</head>
<body>
    <div class="container">
        <header class="page-header">
            <h1 class="title">ğŸ¤– í˜¼ë°¥ëŸ¬ Â· í…ŒìŠ¤íŠ¸ ë´‡</h1>
            <p class="muted" style="margin-top:4px">ì´ í˜ì´ì§€ëŠ” <b>ì¡°ê±´ ë¬´ì‹œ</b>í•˜ê³  í…ŒìŠ¤íŠ¸ë´‡ê³¼ <b>ì¦‰ì‹œ ë§¤ì¹­</b>í•´ ì±„íŒ…ë°©ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
        </header>

        <div class="card" style="max-width:560px">
            <div class="row" style="gap:12px; margin-bottom:8px">
                <button id="startBotBtn" class="btn outline">í…ŒìŠ¤íŠ¸ë´‡ê³¼ ë§¤ì¹­</button>
            </div>
            <p id="status" class="muted" style="min-height:20px"></p>
            <div class="row" style="gap:8px; margin-top:8px">
                <a class="btn outline" href="match.html">ì‚¬ìš©ì ë§¤ì¹­</a>
                <a class="btn outline" href="community.html">ì»¤ë®¤ë‹ˆí‹°</a>
                <a class="btn outline" href="index.html">í™ˆ</a>
            </div>
        </div>
    </div>

    <script type="module">
        const $ = (id) => document.getElementById(id);
        const say = (msg, ok = true) => { const el = $('status'); el.textContent = msg || ''; el.style.color = ok ? 'var(--text-muted,#9fb7d0)' : '#ff6b6b'; };
        async function ensureFbReady(timeoutMs = 8000) {
            if (window.fb) return window.fb;
            const readyP = (window.fbReady && typeof window.fbReady.then === 'function') ? window.fbReady :
                new Promise((resolve, reject) => {
                    const t0 = Date.now(); const iv = setInterval(() => {
                        if (window.fb) { clearInterval(iv); resolve(window.fb); }
                        if (Date.now() - t0 > timeoutMs) { clearInterval(iv); reject(new Error('firebase ë¡œë”ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì–´ìš”.')); }
                    }, 100);
                });
            const timeoutP = new Promise((_, rej) => setTimeout(() => rej(new Error('firebase ë¡œë”ê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì–´ìš”.')), timeoutMs));
            return await Promise.race([readyP, timeoutP]);
        }
        $('startBotBtn').addEventListener('click', async () => {
            const btn = $('startBotBtn'); btn.disabled = true; say('');
            try {
                const fb = await ensureFbReady(); await fb.requireAuth();
                const { id: roomId } = await fb.startWithTestBot();
                say('ì±„íŒ…ë°© ìƒì„± ì™„ë£Œ. ì´ë™í•©ë‹ˆë‹¤â€¦'); await fb.gotoRoom(roomId);
            } catch (e) { console.error(e); say('ì‹œì‘ ì‹¤íŒ¨: ' + (e?.message || e), false); }
            finally { btn.disabled = false; }
        });
    </script>
</body>
</html>
